"use strict";!function(){function t(){var t=angular.injector(["ng"]),e=t.get("$http");return e.get("/api/config").then(function(t){n.constant("githubAppId",t.data.githubAppId)})}function e(){angular.element(document).ready(function(){angular.bootstrap(document,["myApp"])})}$.material.init();var n=angular.module("myApp",["ngRoute","satellizer","ngMaterial","angularGrid","angular-images-loaded"]);n.config(["githubAppId","$routeProvider","$httpProvider","$authProvider",function(t,e,n,a){e.when("/Home",{templateUrl:"/app/views/home.html",controller:"homeCtrl",controllerAs:"vm"}).when("/Login",{templateUrl:"/app/views/login.html",controller:"loginCtrl",controllerAs:"vm"}).when("/Me",{templateUrl:"/app/views/me.html",controller:"meCtrl",controllerAs:"vm"}).when("/Add",{templateUrl:"/app/views/add.html",controller:"addCtrl",controllerAs:"vm"}).when("/User/:userid",{templateUrl:"/app/views/user-wall.html",controller:"userWallCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/Home"}),a.github({clientId:t})}]),n.run(["$rootScope","$window","$auth","$http",function(t,e,n,a){if(n.isAuthenticated()&&e.localStorage.currentUser)try{t.currentUser=JSON.parse(e.localStorage.currentUser)}catch(o){}}]),t().then(e)}(),function(){var t=angular.module("myApp");t.controller("addCtrl",["$scope","$http","$auth",function(t,e,n){var a=this;a.isAuthenticated=n.isAuthenticated,a.loading=!1,a.message="",a.pin={title:"",url:""};var o=function(t){a.loading=!1,a.message=t.data,console.log(t.data)};a.addPin=function(){a.loading=!0,a.message="",e.post("/api/pin",a.pin).then(function(t){a.loading=!1,a.pin={title:"",url:""},$.snackbar({content:"Pin added."})},o)}}])}(),function(){var t=angular.module("myApp");t.controller("homeCtrl",["$http","$auth",function(t,e){var n=this;n.isAuthenticated=e.isAuthenticated,n.loading=!0,n.message="",n.images=[],n.imgLoaded={fail:function(t){angular.element(t.images[0].img).attr("src","/img/placeholder.png")}};var a=function(t){n.loading=!1,n.message=t.data,console.log(t.data)};t.get("/api/pin").then(function(t){console.log(t.data.length+" images."),n.loading=!1,n.images=t.data.map(function(t){return t.when=moment(t.when).fromNow(),t})},a)}])}(),function(){var t=angular.module("myApp");t.controller("loginCtrl",["$rootScope","$http","$location","$auth","$window",function(t,e,n,a,o){var r=this;r.message="",r.authenticate=function(e){a.authenticate(e).then(function(e){console.log("logged in"),t.currentUser=e.data.user,o.localStorage.currentUser=JSON.stringify(e.data.user),n.path("/")})["catch"](function(t){console.log("error during login"),t.error?r.message=t.error:t.data?r.message=t.data.message:r.message=t})}}])}(),function(){var t=angular.module("myApp");t.controller("meCtrl",["$scope","$http","$auth",function(t,e,n){var a=this;a.isAuthenticated=n.isAuthenticated}])}(),function(){var t=angular.module("myApp");t.controller("topNavCtrl",["$rootScope","$location","$auth","$http",function(t,e,n,a){var o=this;o.isAuthenticated=function(){return n.isAuthenticated()},o.logout=function(){n.isAuthenticated()&&n.logout().then(function(){t.currentUser=null,$window.localStorage.currentUser=null,e.path("/")})},o.getUsername=function(){return o.isAuthenticated()&&t.currentUser.name||""},o.isActive=function(t){return t===e.path()}}]),t.directive("topNav",function(){return{restrict:"E",templateUrl:"/app/views/top-nav.html",controller:"topNavCtrl",controllerAs:"nav"}})}(),function(){var t=angular.module("myApp");t.controller("userWallCtrl",["$rootScope","$http","$auth","$routeParams",function(t,e,n,a){var o=this;o.isAuthenticated=n.isAuthenticated,o.loading=!0,o.message="",o.images=[],o.editMode=o.isAuthenticated()&&t.currentUser._id==a.userid,o.imgLoaded={fail:function(t){angular.element(t.images[0].img).attr("src","/img/placeholder.png")}},o.remove=function(t){e["delete"]("/api/pin/"+t._id).then(function(e){for(var n=o.images.length-1;n>=0;n--)o.images[n]._id==t._id&&o.images.splice(n,1)},r)};var r=function(t){o.loading=!1,o.message=t.data,console.log(t.data)},i=a.userid;"me"==i&&(i=t.currentUser._id),e.get("/api/pin/"+i).then(function(t){console.log(t.data.length+" images."),o.loading=!1,o.images=t.data.map(function(t){return t.when=moment(t.when).fromNow(),t})},r)}])}();